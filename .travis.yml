language:
  - cpp

cache:
  ccache: true
  directories:
    - $HOME/downloads

env:
  global:
    - CONFIGURATION=Release
    - PYTHON_VERSION=3.6

matrix:
  include:
    - os: linux
    - os: osx


before_install:

  # Travis machines have 2 cores
  - JOBS=2

  # Handle everything using conda
  - git clone https://github.com/astropy/ci-helpers.git;
  - source ci-helpers/travis/setup_conda.sh;
  - source deactivate
  - conda install cmake hdf5==1.8.18 conda-build


script:
  - cd ${TRAVIS_BUILD_DIR}
  - mkdir -p build_travis && cd build_travis
  - if [[ "${TRAVIS_OS_NAME}" == "linux" ]]; then echo $LD_LIBRARY_PATH; fi
  - if [[ "${TRAVIS_OS_NAME}" == "osx" ]]; then echo $DYLD_LIBRARY_PATH; fi
  - echo "cmake .. ${CMAKE_OPTIONS}"
  - cmake -DCMAKE_INSTALL_PREFIX=./simulate_install_dir ..
  - cmake --build . --config ${CONFIGURATION} --target install
    #- |
    #if [[ "${TRAVIS_OS_NAME}" == "linux" ]]; then
    #  cd $TRAVIS_BUILD_DIR/conda_recipe/
    #  conda-build .
    #fi
  # - ctest -v .
  - cd ${TRAVIS_BUILD_DIR}/test
  - mkdir -p build_travis && cd build_travis
  - cmake -DCMAKE_INSTALL_PREFIX=../../build_travis/simulate_install_dir ..
  - cmake --build .
  - ./hello

after_success:

notifications:
  email: false
